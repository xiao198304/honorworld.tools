import{J as H,ab as O,K as S,H as c,I as d,N as A,R as n,ac as X,M as i,O as y,P as w,G as N,L as _,Z as I,ad as G,X as s,ae as K,Y as L,a1 as $,T as z,af as M,ag as Y,ah as Z,$ as Q}from"./index.ece6453d.js";import{t as h,A as W}from"./nftdata.4facb78f.js";import{s as P,c as j,a as ee}from"./function-call.fdc60d6b.js";const te={class:"flex justify-between"},ae={class:"text-base ml-1 inline-block align-top"},oe={key:0,class:"text-sm text-gray-500"},se={key:1,class:"text-sm text-red-500"},ne={class:"text-base ml-1"},le=n("div",{class:"h-40"},null,-1),ue={class:"py-3"},ie={class:"mb-2 text-center"},re={class:"inline-block align-top ml-1 text-gray-900 text-lg font-medium"},ce={class:"mx-auto text-center"},de=I(" \u89E3\u8D28\u62BC "),me=I(" \u8F6C\u8D26 "),pe=H({__name:"NftCard",props:{title:String,thumb:String,amount:{type:Number,default:1},quality:{type:Number,default:1},race:{type:Number,default:1},level:{type:Number,default:1},lvPower:{type:Number,default:1},className:{type:Number,default:1},source:{type:Number,default:1},code:{type:Number,default:1001},tokenId:{type:Number,default:0}},emits:["onRefresh"],setup(U,{emit:p}){const e=U,{address:t,signer:V}=O(),r=["border-gray-500","border-gray-500","border-green-500","border-blue-500","border-purple-500","border-yellow-500"],D=S(!1),b=S(""),E=S(1),T=()=>{E.value=e.amount,D.value=!0},q=async()=>{P({duration:0,forbidClick:!0,message:"\u64CD\u4F5C\u8FDB\u884C\u4E2D..."}),e.tokenId==0?await(await new $(h.HeroNFT1155.address,h.HeroNFT1155.abi,V.value).safeTransferFrom(t.value,b.value,e.code,E.value,"0x00")).wait():await(await new $(h.HeroNFT.address,h.HeroNFT.abi,V.value).safeTransferFrom(t.value,b.value,e.tokenId)).wait(),j(),p("onRefresh")},B=async()=>{P({duration:0,forbidClick:!0,message:"\u64CD\u4F5C\u8FDB\u884C\u4E2D..."});const C=h.NFTStaking.address,l=h.NFTStaking.abi;let v=new $(C,l,V.value);e.tokenId==0?await(await v.unstake([e.code],[e.amount],[],{gasLimit:5e5})).wait():await(await v.unstake([e.code],[],[e.tokenId],{gasLimit:5e5})).wait(),j(),p("onRefresh")};return(C,l)=>{const v=c("van-icon"),u=c("van-tag"),o=c("van-button"),g=c("van-cell"),f=c("van-field"),F=c("van-cell-group"),k=c("van-dialog");return d(),A(L,null,[n("div",{class:G(["rounded-lg shadow-lg max-w-sm m-3 border-2",r[e.quality]])},[n("div",{class:"m-2 bg-no-repeat bg-cover bg-top",style:X("background-image: url("+e.thumb+"); background-position-y: -80px")},[n("div",te,[n("div",null,[i(v,{name:"/static/images/race/"+e.race+".png"},null,8,["name"]),n("span",ae,"Lv."+y(e.level),1)]),e.source==1?(d(),A("div",oe,"\u6316\u77FF")):w("",!0),e.source==2?(d(),A("div",se,"\u7A7A\u95F2")):w("",!0),n("div",null,[i(v,{name:"/static/images/item/top_icon2.png"}),n("span",ne,y(e.lvPower),1)])]),le,n("div",ue,[n("div",ie,[i(v,{name:"/static/images/class/"+e.className+".png",size:"1.3rem"},null,8,["name"]),n("span",re,y(e.title),1),e.amount>1?(d(),N(u,{key:0,class:"ml-1",color:"#111827",plain:""},{default:_(()=>[I("X"+y(e.amount),1)]),_:1})):w("",!0)]),n("div",ce,[e.source==1?(d(),N(o,{key:0,plain:"",type:"default",size:"small",icon:"paid-o",class:"mr-2",onClick:B},{default:_(()=>[de]),_:1})):w("",!0),e.source==2?(d(),N(o,{key:1,type:"default",size:"small",icon:"share-o",onClick:T},{default:_(()=>[me]),_:1})):w("",!0)])])],4)],2),i(k,{show:D.value,"onUpdate:show":l[2]||(l[2]=m=>D.value=m),title:"\u6807\u9898","show-cancel-button":"",onConfirm:q},{default:_(()=>[i(F,{inset:""},{default:_(()=>[i(g,{title:"\u5F53\u524D\u5730\u5740",value:s(t)},null,8,["value"]),i(g,{title:"NFT",value:e.title},null,8,["value"]),i(f,{modelValue:U.amount,"onUpdate:modelValue":l[0]||(l[0]=m=>K(amount)?amount.value=m:null),type:"digit",label:"\u8F6C\u8D26\u6570\u91CF"},null,8,["modelValue"]),i(f,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=m=>b.value=m),label:"\u63A5\u53D7\u5730\u5740"},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])],64)}}}),ve={class:"flex justify-between mx-4 my-2"},ge={class:"text-sm text-gray-500"},fe=I("NFT\u603B\u6570\uFF1A"),_e={class:"text-gray-900"},ye={class:"text-sm text-gray-500"},we={class:"grid grid-cols-2 md:lg:xl:grid-cols-5 group bg-white shadow-xl shadow-neutral-100 border"},xe=H({__name:"index",setup(U){const{address:p,isActivated:e}=O();let t=z({nfts:[],limit:10,page:1,total:0,totalnft:0});const{onActivated:V}=M();let r=z({source:0,quality:0,race:0});const D=[{text:"\u5168\u90E8\u72B6\u6001",value:0},{text:"\u77FF\u6C60",value:1},{text:"\u7A7A\u95F2",value:2}],b=[{text:"\u5168\u90E8\u54C1\u8D28",value:0},{text:"\u666E\u901A",value:1},{text:"\u826F\u597D",value:2},{text:"\u7A00\u6709",value:3},{text:"\u53F2\u8BD7",value:4},{text:"\u4F20\u8BF4",value:5},{text:"\u795E\u8BDD",value:6}],E=[{text:"\u5168\u90E8\u79CD\u65CF",value:0},{text:"\u4EBA\u65CF",value:1},{text:"\u517D\u65CF",value:2},{text:"\u7CBE\u7075\u65CF",value:3},{text:"\u4E0D\u6B7B\u65CF",value:4}],T=S(!1),q=async()=>{await l(p.value),ee("\u5237\u65B0\u6210\u529F"),T.value=!1},B=async(u=0)=>{console.log(r.source),await l(p.value)},C=async()=>{console.log(t.page),await l(p.value)};V(async({address:u})=>{console.log("activate: ",u),await l(u)}),Y(async()=>{console.log("activate: ",p.value),await l(p.value)});async function l(u=""){P({duration:0,forbidClick:!0,message:"\u6570\u636E\u66F4\u65B0\u4E2D..."});const o=await v(u,r.quality,r.race,r.source,t.page,t.limit);t.nfts=o.nfts,t.limit=o.limit,t.page=o.page,t.total=o.total,t.totalnft=o.totalnft,j()}async function v(u="",o=0,g=0,f=0,F=1,k=20){if(u=="")return{nfts:[],limit:k,page:F,total:0,totalnft:0};let m=!0;f==3&&(m=!1,f=0);const x=await Z("https://service-q42yv3pc-1258577806.hk.apigw.tencentcs.com/release/",{url:"nft/inventory/list",pjson:{address:u,merge:m,page:{number:F,size:k},filter:{quality:o,race:g,source:f}}}),J=W(x.list);return console.log("res: ",x),{nfts:J,limit:x.limit,page:x.page,total:x.total,totalnft:x.totalnft}}return(u,o)=>{const g=c("van-dropdown-item"),f=c("van-dropdown-menu"),F=c("van-sticky"),k=c("van-pull-refresh"),m=c("van-pagination");return d(),A(L,null,[i(F,{"offset-top":40},{default:_(()=>[s(e)?(d(),N(f,{key:0},{default:_(()=>[i(g,{modelValue:s(r).source,"onUpdate:modelValue":o[0]||(o[0]=a=>s(r).source=a),options:D,onChange:B},null,8,["modelValue"]),i(g,{modelValue:s(r).quality,"onUpdate:modelValue":o[1]||(o[1]=a=>s(r).quality=a),options:b,onChange:B},null,8,["modelValue"]),i(g,{modelValue:s(r).race,"onUpdate:modelValue":o[2]||(o[2]=a=>s(r).race=a),options:E,onChange:B},null,8,["modelValue"])]),_:1})):w("",!0)]),_:1}),n("div",ve,[n("div",ge,[fe,n("span",_e,y(s(t).totalnft),1)]),n("div",ye,"\u5171"+y(s(t).total)+"\u6761\uFF0C\u6BCF\u9875"+y(s(t).limit)+"\u6761\uFF0C\u5F53\u524D\u7B2C"+y(s(t).page)+"\u9875",1)]),i(k,{modelValue:T.value,"onUpdate:modelValue":o[3]||(o[3]=a=>T.value=a),onRefresh:q},{default:_(()=>[n("div",we,[(d(!0),A(L,null,Q(s(t).nfts,(a,R)=>(d(),N(pe,{key:"nft"+R,title:u.$t(a.name),thumb:"/static/images/"+a.code+".png",amount:a.amount,quality:a.quality,level:a.level,race:a.race,lvPower:a.lvPower,className:a.class,source:a.source,code:a.code,tokenId:a.tokenId,onOnRefresh:q},null,8,["title","thumb","amount","quality","level","race","lvPower","className","source","code","tokenId"]))),128))])]),_:1},8,["modelValue"]),s(t).total>0?(d(),N(m,{key:0,modelValue:s(t).page,"onUpdate:modelValue":o[4]||(o[4]=a=>s(t).page=a),"total-items":s(t).total,"items-per-page":s(t).limit,"show-page-size":3,"force-ellipses":"",onChange:C},null,8,["modelValue","total-items","items-per-page"])):w("",!0)],64)}}});export{xe as default};
