import{P as rt,Q as it,ak as ut,R as g,H as i,I as p,a3 as T,a1 as d,aq as pt,a0 as o,a2 as l,a5 as _,G as O,W as u,a4 as j,ae as ft,$ as r,a7 as tt,Y as G,ar as J,as as z,Z as U,X as Q,S as K,at as vt,au as yt,U as _t,av as gt,aw as D,O as st,ax as lt,a6 as bt}from"./index.4e9c50fa.js";import{s as wt,b as kt,r as ht,A as Nt}from"./hero.01265014.js";const $t={class:"flex justify-between"},Ct={class:"text-base ml-1 inline-block align-top"},Vt={key:0,class:"text-sm text-gray-500"},Tt={key:1,class:"text-sm text-red-500"},St={class:"text-base ml-1"},Ft=d("div",{class:"h-40"},null,-1),xt={class:"py-3"},Ot={class:"mb-2 text-center"},Ut={class:"inline-block align-top ml-1 text-gray-900 text-lg font-medium"},qt={key:0,class:"mx-auto text-center"},At={key:1,class:"mx-auto text-center"},Bt=rt({__name:"NftCard",props:{title:String,thumb:String,amount:{type:Number,default:1},quality:{type:Number,default:1},race:{type:Number,default:1},level:{type:Number,default:1},lvPower:{type:Number,default:1},className:{type:Number,default:1},source:{type:Number,default:1},code:{type:Number,default:1001},tokenId:{type:Number,default:0},isSoulbound:{type:Boolean,default:!1}},emits:["onRefresh"],setup(et,{emit:S}){const a=et,{t:q}=it(),{address:b,signer:P}=ut(),L=["border-gray-500","border-gray-500","border-green-500","border-blue-500","border-purple-500","border-yellow-500"],F=g(!1),w=g(""),k=g(1),f=g(!1),A=g(1),W=()=>{A.value=a.amount,f.value=!0},c=()=>{k.value=a.amount,F.value=!0},Y=async()=>{G({duration:0,message:q("common.Operation_progress")});try{a.tokenId==0?await(await new J(z.HeroNFT1155.address,z.HeroNFT1155.abi,P.value).safeTransferFrom(b.value,w.value,a.code,k.value,"0x00")).wait():await(await new J(z.HeroNFT.address,z.HeroNFT.abi,P.value).transferFrom(b.value,w.value,a.tokenId)).wait()}catch{U(),Q("Error!")}U(),S("onRefresh")},v=async()=>{G({duration:0,forbidClick:!0,message:q("common.Operation_progress")});const s=z.NFTStaking.address,m=z.NFTStaking.abi;let y=new J(s,m,P.value);try{a.tokenId==0?await(await y.unstake([a.code],[A.value],[])).wait():await(await y.unstake([],[],[a.tokenId])).wait()}catch{U(),Q("Error!")}U(),S("onRefresh")};return(s,m)=>{const y=i("van-icon"),h=i("van-tag"),M=i("van-button"),N=i("van-cell"),$=i("van-stepper"),R=i("van-cell-group"),E=i("van-dialog"),e=i("van-field");return p(),T(tt,null,[d("div",{class:ft(["rounded-lg shadow-lg max-w-sm m-3 border-2",L[a.quality]])},[d("div",{class:"m-2 bg-no-repeat bg-cover bg-top",style:pt("background-image: url("+a.thumb+"); background-position-y: -80px")},[d("div",$t,[d("div",null,[o(y,{name:"/static/images/race/"+a.race+".png"},null,8,["name"]),d("span",Ct,"Lv."+l(a.level),1)]),a.source==1?(p(),T("div",Vt,l(s.$t("mynft.mine_pool")),1)):_("",!0),a.source==2?(p(),T("div",Tt,l(s.$t("mynft.free")),1)):_("",!0),d("div",null,[o(y,{name:"/static/images/item/top_icon2.png"}),d("span",St,l(a.lvPower),1)])]),Ft,d("div",xt,[d("div",Ot,[o(y,{name:"/static/images/class/"+a.className+".png",size:"1.3rem"},null,8,["name"]),d("span",Ut,l(a.title),1),a.amount>1?(p(),O(h,{key:0,class:"ml-1",color:"#111827",plain:""},{default:u(()=>[j("X"+l(a.amount),1)]),_:1})):_("",!0)]),a.isSoulbound?(p(),T("div",At,[d("span",null,l(s.$t("mynft.Soulbound")),1)])):(p(),T("div",qt,[a.source==1&&a.amount==1?(p(),O(M,{key:0,plain:"",type:"default",size:"small",icon:"paid-o",class:"mr-2",onClick:v},{default:u(()=>[j(l(s.$t("mynft.unstake")),1)]),_:1})):_("",!0),a.source==1&&a.amount>1?(p(),O(M,{key:1,plain:"",type:"default",size:"small",icon:"paid-o",class:"mr-2",onClick:W},{default:u(()=>[j(l(s.$t("mynft.unstake")),1)]),_:1})):_("",!0),a.source==2?(p(),O(M,{key:2,type:"default",size:"small",icon:"share-o",onClick:c},{default:u(()=>[j(l(s.$t("mynft.transfer")),1)]),_:1})):_("",!0)]))])],4)],2),o(E,{show:f.value,"onUpdate:show":m[1]||(m[1]=t=>f.value=t),title:s.$t("mynft.unstake"),"show-cancel-button":"",onConfirm:v},{default:u(()=>[o(R,{inset:""},{default:u(()=>[o(N,{title:"NFT",value:a.title},null,8,["value"]),o(N,{title:s.$t("mynft.amount_unstake")},{value:u(()=>[o($,{modelValue:A.value,"onUpdate:modelValue":m[0]||(m[0]=t=>A.value=t),min:"1",max:a.amount},null,8,["modelValue","max"])]),_:1},8,["title"])]),_:1})]),_:1},8,["show","title"]),o(E,{show:F.value,"onUpdate:show":m[4]||(m[4]=t=>F.value=t),title:s.$t("mynft.transfer"),"show-cancel-button":"",onConfirm:Y},{default:u(()=>[o(R,{inset:""},{default:u(()=>[o(N,{title:s.$t("mynft.from_address"),value:r(b)},null,8,["title","value"]),o(N,{title:"NFT",value:a.title},null,8,["value"]),o(N,{title:s.$t("mynft.amount_transfer")},{value:u(()=>[o($,{modelValue:k.value,"onUpdate:modelValue":m[2]||(m[2]=t=>k.value=t),min:"1",max:a.amount},null,8,["modelValue","max"])]),_:1},8,["title"]),o(e,{modelValue:w.value,"onUpdate:modelValue":m[3]||(m[3]=t=>w.value=t),label:s.$t("mynft.to_address"),placeholder:s.$t("mynft.toaddress_tips")},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1},8,["show","title"])],64)}}}),It={key:0,class:"pl-8 py-2 bg-white"},zt={class:"text-gray-500 pr-2 pt-2"},jt={class:"text-gray-800 pt-2"},Jt={class:"flex justify-between mx-4 my-2"},Pt={class:"text-sm text-gray-500"},Lt={class:"text-gray-900"},Mt={class:"text-sm text-gray-500"},Rt={class:"grid grid-cols-2 md:lg:xl:grid-cols-5 group bg-white shadow-xl shadow-neutral-100 border"},Xt=rt({__name:"index",setup(et){const{t:S}=it(),a=g(!1),q=g(""),b=g(1),P=()=>{b.value=s.bit,a.value=!0},L=function(e){return e.text=S(e.text),e};let F=JSON.parse(JSON.stringify(wt)),w=JSON.parse(JSON.stringify(kt)),k=JSON.parse(JSON.stringify(ht));const{address:f,isActivated:A,signer:W}=ut();let c=K({nfts:[],limit:10,page:1,total:0,totalnft:0});const{onActivated:Y}=vt();let v=K({source:0,quality:0,race:0});const s=K({bit:0,unlock:0}),m=g(!1),y=async()=>{await $(f.value),Q(S("common.Refresh_succeeded")),m.value=!1},h=async(e=0)=>{console.log(v.source),await $(f.value)},M=async()=>{console.log(c.page),await $(f.value)};Y(async({address:e})=>{console.log("activate: ",e),await $(e)}),yt(()=>{F=F.map(L),w=w.map(L),k=k.map(L)}),_t(async()=>{console.log("activate: ",f.value),await $(f.value),await N(f.value)});async function N(e=""){let t=new J(D.address,D.abi,st),B=new J(lt.address,lt.abi,st),C=await t.balanceOf(e,100);console.log("bit_crystal_balance ",C.toNumber()),s.bit=C.toNumber();let x=await B.balanceOf(e,100);console.log("unlock_crystal_balance ",x.toNumber()),s.unlock=x.toNumber()}async function $(e=""){G({duration:0,forbidClick:!0,message:S("common.Updating_data")});const t=await R(e,v.quality,v.race,v.source,c.page,c.limit);c.nfts=t.nfts,c.limit=t.limit,c.page=t.page,c.total=t.total,c.totalnft=t.totalnft,U()}async function R(e="",t=0,B=0,C=0,x=1,I=20){if(e=="")return{nfts:[],limit:I,page:x,total:0,totalnft:0};let H=!0;C==3&&(H=!1,C=0);const V=await gt("https://service-1zp4p22u-1258577806.hk.apigw.tencentcs.com/release/nftlist",{pjson:{address:e,merge:H,page:{number:x,size:I},filter:{quality:t,race:B,source:C}}}),X=Nt(V.list);return console.log("res: ",V),{nfts:X,limit:V.limit,page:V.page,total:V.total,totalnft:V.totalnft}}const E=async()=>{G({duration:0,message:S("common.Operation_progress")});try{await(await new J(D.address,D.abi,W.value).safeTransferFrom(f.value,q.value,100,b.value,"0x00")).wait()}catch{U(),Q("Error!")}await N(f.value),U()};return(e,t)=>{const B=i("van-col"),C=i("van-button"),x=i("van-row"),I=i("van-dropdown-item"),H=i("van-dropdown-menu"),at=i("van-sticky"),ot=i("van-pull-refresh"),Z=i("van-icon"),V=i("van-pagination"),X=i("van-cell"),nt=i("van-field"),ct=i("van-cell-group"),dt=i("van-dialog");return p(),T(tt,null,[o(at,{"offset-top":40},{default:u(()=>[s.bit>0?(p(),T("div",It,[o(x,{justify:"space-between",class:"text-center"},{default:u(()=>[o(B,{span:"16 text-left align-bottom align-text-bottom pt-2"},{default:u(()=>[d("span",zt,l(e.$t("mynft.crystal_bit")),1),d("span",jt,l(s.bit),1)]),_:1}),o(B,{span:"8"},{default:u(()=>[o(C,{type:"default",size:"small",icon:"share-o",onClick:P},{default:u(()=>[j(l(e.$t("mynft.transfer")),1)]),_:1})]),_:1})]),_:1})])):_("",!0),r(A)?(p(),O(H,{key:1},{default:u(()=>[o(I,{modelValue:r(v).source,"onUpdate:modelValue":t[0]||(t[0]=n=>r(v).source=n),options:r(F),onChange:h},null,8,["modelValue","options"]),o(I,{modelValue:r(v).quality,"onUpdate:modelValue":t[1]||(t[1]=n=>r(v).quality=n),options:r(w),onChange:h},null,8,["modelValue","options"]),o(I,{modelValue:r(v).race,"onUpdate:modelValue":t[2]||(t[2]=n=>r(v).race=n),options:r(k),onChange:h},null,8,["modelValue","options"])]),_:1})):_("",!0)]),_:1}),d("div",Jt,[d("div",Pt,[j(l(e.$t("mynft.total_NFT"))+"\uFF1A",1),d("span",Lt,l(r(c).totalnft),1)]),d("div",Mt,l(e.$t("mynft.total_of"))+l(r(c).total)+l(e.$t("mynft.items"))+"\uFF0C"+l(e.$t("mynft.per_page"))+l(r(c).limit)+l(e.$t("mynft.items"))+"\uFF0C"+l(e.$t("mynft.current"))+l(r(c).page)+l(e.$t("mynft.page")),1)]),o(ot,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=n=>m.value=n),onRefresh:y},{default:u(()=>[d("div",Rt,[(p(!0),T(tt,null,bt(r(c).nfts,(n,mt)=>(p(),O(Bt,{key:"nft"+mt,title:e.$t(n.name),thumb:"/static/images/"+(n.code>1e4?n.code%1e4:n.code)+".png",amount:n.amount,quality:n.quality,level:n.level,race:n.race,lvPower:n.lvPower,className:n.class,source:n.source,code:n.code,tokenId:n.tokenId,isSoulbound:n.isSoulbound,onOnRefresh:y},null,8,["title","thumb","amount","quality","level","race","lvPower","className","source","code","tokenId","isSoulbound"]))),128))])]),_:1},8,["modelValue"]),r(c).total>0?(p(),O(V,{key:0,modelValue:r(c).page,"onUpdate:modelValue":t[4]||(t[4]=n=>r(c).page=n),"total-items":r(c).total,"items-per-page":r(c).limit,"show-page-size":3,"force-ellipses":"",onChange:M},{"prev-text":u(()=>[o(Z,{name:"arrow-left"})]),"next-text":u(()=>[o(Z,{name:"arrow"})]),_:1},8,["modelValue","total-items","items-per-page"])):_("",!0),o(dt,{show:a.value,"onUpdate:show":t[7]||(t[7]=n=>a.value=n),title:e.$t("mynft.transfer"),"show-cancel-button":"",onConfirm:E},{default:u(()=>[o(ct,{inset:""},{default:u(()=>[o(X,{title:e.$t("mynft.from_address"),value:r(f)},null,8,["title","value"]),o(X,{title:"NFT",value:e.$t("mynft.crystal_bit")},null,8,["value"]),o(nt,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=n=>b.value=n),type:"digit",label:e.$t("mynft.amount_transfer")},null,8,["modelValue","label"]),o(nt,{modelValue:q.value,"onUpdate:modelValue":t[6]||(t[6]=n=>q.value=n),label:e.$t("mynft.to_address"),placeholder:e.$t("mynft.toaddress_tips")},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1},8,["show","title"])],64)}}});export{Xt as default};
