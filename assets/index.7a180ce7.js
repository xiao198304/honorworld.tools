import{P as L,H as h,I as x,a3 as S,a0 as s,W as l,a1 as m,ae as M,a2 as d,a4 as H,$ as r,aq as $,ar as V,a7 as C,a6 as P,G as N,J as j,K as R,L as Y,Q as z,S as B,as as F,ab as T,Y as U,N as A,Z as I}from"./index.23a6bd48.js";import{_ as D}from"./DataCell.vue_vue_type_script_setup_true_lang.afb7434c.js";import{q as J}from"./hero.d6daa2c6.js";function K(_,t){return Math.floor(_*t/60/200)}function E(_,t){let a=25,e=Number(_);return a-=25*e/(e+1e3),Math.floor(60*t/a)}function q(_,t=-1){if(t==0)return[{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0}];let a=[0,0,0],e=[0,0,0],n=[0,0,0],c=0,u=0;for(let o=0;o<_.length;o++){let w=E(_[o].defense,_[o].hp);a[o]=w,t>0&&t<w&&(a[o]=t),e[o]=K(_[o].attack,a[o]),n[o]=Math.floor(e[o]/10+1),u+=e[o],a[o]>c&&(c=a[o])}let k=Math.floor(u/10);return[{max_sec:c,max_floor:k,kill_count:u},{max_sec:a[0],max_floor:n[0],kill_count:e[0]},{max_sec:a[1],max_floor:n[1],kill_count:e[1]},{max_sec:a[2],max_floor:n[2],kill_count:e[2]}]}function G(_,t=1e3){let a=q(_);if(t>a[0].max_floor||t<=0)return-1;let e=1,n=a[0].max_sec;for(;e<=n;){let c=Math.floor((e+n)/2),u=q(_,c);if(t==u[0].max_floor)return c;t>u[0].max_floor?e=c+1:n=c-1}return-1}const Q={class:"rounded-lg shadow-lg max-w-sm m-3 border-2"},W={class:"pt-6 pl-2"},Z={class:"text-gray-500 text-sm pt-2"},X={class:"text-gray-500 text-sm pt-1"},tt={class:"text-gray-500 text-sm pt-1"},at={class:"text-gray-500 text-sm pt-1"},et={class:"text-gray-500 text-sm pt-1"},ot={class:"absolute -top-4 -left-8"},st={class:"-mt-2 text-gray-500 text-center text-sm"},nt={class:"text-gray-500 text-center text-sm"},lt={class:"text-gray-500 text-center text-sm"},rt=L({__name:"PlayerCard",props:{data:null},setup(_){const t=_;return(a,e)=>{const n=h("van-col"),c=h("van-tag"),u=h("van-row"),k=h("van-image"),i=h("van-badge");return x(),S("div",Q,[s(u,{justify:"space-around"},{default:l(()=>[s(n,{span:"4"},{default:l(()=>[m("div",W,[m("span",{class:M(["rounded-lg bg-blue-500 p-2 text-white",t.data.Rank<100?"text-3xl":"text-xl"])},d(t.data.Rank),3)])]),_:1}),s(n,{span:"20"},{default:l(()=>[m("div",Z,d(t.data.Name),1),s(u,{justify:"space-around"},{default:l(()=>[s(n,{span:"6"},{default:l(()=>[m("div",null,[s(c,{plain:"",type:"primary",class:"mr-2"},{default:l(()=>[H(d(t.data.Player.Level)+d(a.$t("dragon_season.level")),1)]),_:1})]),m("div",null,[s(c,{type:"primary"},{default:l(()=>[H(d(a.$t("dragon_stage."+t.data.Player.Stage)),1)]),_:1})])]),_:1}),s(n,{span:"10"},{default:l(()=>[m("div",X,d(t.data.Player.FightPower)+d(a.$t("dragon_season.floor"))+"/"+d(r($)(r(q)(t.data.Player.Heroes)[0].max_sec)),1),m("div",tt,"1000"+d(a.$t("dragon_season.floor"))+"/"+d(r($)(r(G)(t.data.Player.Heroes))),1)]),_:1}),s(n,{span:"8"},{default:l(()=>[m("div",at,d(a.$t("dragon_season.hwt"))+":"+d(r(V)(t.data.HwtReward,".")),1),m("div",et,d(a.$t("dragon_season.crystal"))+":"+d(r(V)(t.data.UsdReward,".")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(u,{class:"m-2",justify:"space-around"},{default:l(()=>[(x(!0),S(C,null,P(t.data.Player.Heroes,(o,w)=>(x(),N(n,{span:"8",key:"hero"+w},{default:l(()=>{var p;return[m("div",{class:M(["border-solid border-1 rounded m-1 p-1","border-"+((p=r(J).find(f=>f.quality==o.grade))==null?void 0:p.color)+"-500"])},[s(i,{content:o.level,position:"top-left",color:"#1989fa"},{default:l(()=>[s(u,null,{default:l(()=>[s(n,{span:"16",class:"relative"},{default:l(()=>[m("div",ot,[s(k,{width:"8rem",height:"6rem",fit:"cover",position:"left",src:"/static/images/dragon/hero/"+o.code+".png"},null,8,["src"]),m("div",st,d(a.$t("dragon_hero."+o.code)),1),m("div",nt,d(r(q)([o])[0].max_floor)+d(a.$t("dragon_season.floor")),1),m("div",lt,d(r($)(r(q)([o])[0].max_sec)),1)])]),_:2},1024),s(n,{span:"8"},{default:l(()=>[(x(!0),S(C,null,P(o.items,(f,b)=>{var y;return x(),S("div",{key:"item"+b,class:M(["m-1 mt-3","bg-"+((y=r(J).find(v=>v.quality==f.grade))==null?void 0:y.color)+"-400"])},[s(i,{content:f.level,position:"top-left",color:"#1989fa"},{default:l(()=>[s(i,{content:f.soulbound?"B":"0",position:"bottom-left",color:"#6B7280","show-zero":!1},{default:l(()=>[s(i,{content:f.score,position:"bottom-right",color:"#6B7280"},{default:l(()=>[s(k,{width:"100%",height:"100%",fit:"cover",src:"/static/images/dragon/item/"+f.code+".png"},null,8,["src"])]),_:2},1032,["content"])]),_:2},1032,["content"])]),_:2},1032,["content"])],2)}),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])],2)]}),_:2},1024))),128))]),_:1})])}}}),it="https://tools-1258577806.cos.ap-hongkong.myqcloud.com/honorworld/dragon/season/last.json",dt=j("season",{state:()=>({data:[],info:{}}),actions:{async initSeason(){let _=it+"?="+R().format("YYYYMMDDHHMM"),t=await Y(_);return this.data=t.data,this.info=t.info,this.data}}}),_t=dt,ft=L({__name:"index",setup(_){const{t}=z(),a=_t();let e=B({quality:0,sort:0});const n=function(p){return p.text=t(p.text),p};let c=[{text:"dragon_season.all_quality",value:0},{text:"dragon_season.one_5",value:1},{text:"dragon_season.two_5",value:2},{text:"dragon_season.all_5",value:3},{text:"dragon_season.zero_5",value:4}],u=[{text:"dragon_season.asc",value:0},{text:"dragon_season.desc",value:1}];const k=async()=>{console.log(e.quality,e.sort),await w()};let i=B({data:[],limit:5,alldata:[]});const o=p=>i.limit=p;F(()=>{c=c.map(n),u=u.map(n)}),T(async()=>{await w()});async function w(p=!1){U({duration:0,message:t("common.Updating_data")}),(a.data.length==0||p)&&await a.initSeason();let f=JSON.parse(JSON.stringify(a.data));i.alldata=f.sort(A("Rank")),e.quality>0?i.data=i.alldata.filter(b=>{let y=!1,v=0;for(let g=0;g<b.Player.Heroes.length;g++)b.Player.Heroes[g].grade==5&&(v=v+1);return v==e.quality&&(y=!0),e.quality==4&&v==0&&(y=!0),y}):i.data=JSON.parse(JSON.stringify(i.alldata)),e.sort==1&&(i.data=i.data.reverse()),I()}return(p,f)=>{const b=h("van-dropdown-item"),y=h("van-dropdown-menu"),v=h("van-sticky");return x(),S(C,null,[s(v,{"offset-top":40},{default:l(()=>[s(y,{"z-index":9999},{default:l(()=>[s(b,{modelValue:r(e).quality,"onUpdate:modelValue":f[0]||(f[0]=g=>r(e).quality=g),options:r(c),onChange:k,teleport:"body"},null,8,["modelValue","options"]),s(b,{modelValue:r(e).sort,"onUpdate:modelValue":f[1]||(f[1]=g=>r(e).sort=g),options:r(u),onChange:k,teleport:"body"},null,8,["modelValue","options"])]),_:1})]),_:1}),m("div",null,[(x(),N(D,{isinset:!1,listLength:r(i).data.length,onChangeCount:o,key:"bad"+r(i).data.length},{default:l(()=>[(x(!0),S(C,null,P(r(i).data.slice(0,r(i).limit),(g,O)=>(x(),N(rt,{key:"player"+O,data:g},null,8,["data"]))),128))]),_:1},8,["listLength"]))])],64)}}});export{ft as default};
