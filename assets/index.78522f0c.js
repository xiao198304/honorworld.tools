import{P as L,H as k,I as x,a3 as b,a0 as s,W as r,a1 as f,ae as M,a2 as d,a4 as H,$ as l,aq as $,ar as V,a7 as C,a6 as P,G as N,J as O,K as j,L as R,Q as Y,S as B,as as F,ab as T,Y as U,N as z,Z as A}from"./index.3b891e7f.js";import{_ as I}from"./DataCell.vue_vue_type_script_setup_true_lang.159ba1fb.js";import{q as J}from"./hero.d6daa2c6.js";function D(_,t){return Math.floor(_*t/60/200)}function K(_,t){let a=25,e=Number(_);return a-=25*e/(e+1e3),Math.floor(60*t/a)}function q(_,t=-1){if(t==0)return[{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0}];let a=[0,0,0],e=[0,0,0],n=[0,0,0],c=0,u=0;for(let o=0;o<_.length;o++){let v=K(_[o].defense,_[o].hp);a[o]=v,t>0&&t<v&&(a[o]=t),e[o]=D(_[o].attack,a[o]),n[o]=Math.floor(e[o]/10+1),u+=e[o],a[o]>c&&(c=a[o])}let h=Math.floor(u/10);return[{max_sec:c,max_floor:h,kill_count:u},{max_sec:a[0],max_floor:n[0],kill_count:e[0]},{max_sec:a[1],max_floor:n[1],kill_count:e[1]},{max_sec:a[2],max_floor:n[2],kill_count:e[2]}]}function E(_,t=1e3){let a=q(_);if(t>a[0].max_floor||t<=0)return-1;let e=1,n=a[0].max_sec;for(;e<=n;){let c=Math.floor((e+n)/2),u=q(_,c);if(t==u[0].max_floor)return c;t>u[0].max_floor?e=c+1:n=c-1}return-1}const G={class:"rounded-lg shadow-lg max-w-sm m-3 border-2"},Q={class:"pt-6 pl-2"},W={class:"text-gray-500 text-sm pt-2"},Z={class:"text-gray-500 text-sm pt-1"},X={class:"text-gray-500 text-sm pt-1"},tt={class:"text-gray-500 text-sm pt-1"},at={class:"text-gray-500 text-sm pt-1"},et={class:"absolute -top-4 -left-8"},ot={class:"-mt-2 text-gray-500 text-center text-sm"},st={class:"text-gray-500 text-center text-sm"},nt={class:"text-gray-500 text-center text-sm"},lt=L({__name:"PlayerCard",props:{data:null},setup(_){const t=_;return(a,e)=>{const n=k("van-col"),c=k("van-tag"),u=k("van-row"),h=k("van-image"),i=k("van-badge");return x(),b("div",G,[s(u,{justify:"space-around"},{default:r(()=>[s(n,{span:"4"},{default:r(()=>[f("div",Q,[f("span",{class:M(["rounded-lg bg-blue-500 p-2 text-white",t.data.Rank<100?"text-3xl":"text-xl"])},d(t.data.Rank),3)])]),_:1}),s(n,{span:"20"},{default:r(()=>[f("div",W,d(t.data.Name),1),s(u,{justify:"space-around"},{default:r(()=>[s(n,{span:"6"},{default:r(()=>[f("div",null,[s(c,{plain:"",type:"primary",class:"mr-2"},{default:r(()=>[H(d(t.data.Player.Level)+d(a.$t("dragon_season.level")),1)]),_:1})]),f("div",null,[s(c,{type:"primary"},{default:r(()=>[H(d(a.$t("dragon_stage."+t.data.Player.Stage)),1)]),_:1})])]),_:1}),s(n,{span:"10"},{default:r(()=>[f("div",Z,d(t.data.Player.FightPower)+d(a.$t("dragon_season.floor"))+"/"+d(l($)(l(q)(t.data.Player.Heroes)[0].max_sec)),1),f("div",X,"1000"+d(a.$t("dragon_season.floor"))+"/"+d(l($)(l(E)(t.data.Player.Heroes))),1)]),_:1}),s(n,{span:"8"},{default:r(()=>[f("div",tt,d(a.$t("dragon_season.hwt"))+":"+d(l(V)(t.data.HwtReward,".")),1),f("div",at,d(a.$t("dragon_season.crystal"))+":"+d(l(V)(t.data.UsdReward,".")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(u,{class:"m-2",justify:"space-around"},{default:r(()=>[(x(!0),b(C,null,P(t.data.Player.Heroes,(o,v)=>(x(),N(n,{span:"8",key:"hero"+v},{default:r(()=>{var g;return[f("div",{class:M(["border-solid border-1 rounded m-1 p-1","border-"+((g=l(J).find(m=>m.quality==o.grade))==null?void 0:g.color)+"-500"])},[s(i,{content:o.level,position:"top-left",color:"#1989fa"},{default:r(()=>[s(u,null,{default:r(()=>[s(n,{span:"16",class:"relative"},{default:r(()=>[f("div",et,[s(h,{width:"8rem",height:"6rem",fit:"cover",position:"left",src:"/static/images/dragon/hero/"+o.code+".png"},null,8,["src"]),f("div",ot,d(a.$t("dragon_hero."+o.code)),1),f("div",st,d(l(q)([o])[0].max_floor)+d(a.$t("dragon_season.floor")),1),f("div",nt,d(l($)(l(q)([o])[0].max_sec)),1)])]),_:2},1024),s(n,{span:"8"},{default:r(()=>[(x(!0),b(C,null,P(o.items,(m,w)=>{var y;return x(),b("div",{key:"item"+w,class:M(["m-1 mt-3","bg-"+((y=l(J).find(p=>p.quality==m.grade))==null?void 0:y.color)+"-400"])},[s(i,{content:m.level,position:"top-left",color:"#1989fa"},{default:r(()=>[s(i,{content:m.soulbound?"B":"0",position:"bottom-left",color:"#6B7280","show-zero":!1},{default:r(()=>[s(i,{content:m.score,position:"bottom-right",color:"#6B7280"},{default:r(()=>[s(h,{width:"100%",height:"100%",fit:"cover",src:"/static/images/dragon/item/"+m.code+".png"},null,8,["src"])]),_:2},1032,["content"])]),_:2},1032,["content"])]),_:2},1032,["content"])],2)}),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])],2)]}),_:2},1024))),128))]),_:1})])}}}),rt="https://tools-1258577806.cos.ap-hongkong.myqcloud.com/honorworld/dragon/season/last.json",it=O("season",{state:()=>({data:[],info:{}}),actions:{async initSeason(){let _=rt+"?="+j().format("YYYYMMDDHHMM"),t=await R(_);return this.data=t.data,this.info=t.info,this.data}}}),dt=it,mt=L({__name:"index",setup(_){const{t}=Y(),a=dt();let e=B({quality:0,sort:0});const n=function(g){return g.text=t(g.text),g};let c=[{text:"dragon_season.all_quality",value:0},{text:"dragon_season.one_5",value:1},{text:"dragon_season.two_5",value:2},{text:"dragon_season.all_5",value:3},{text:"dragon_season.zero_5",value:4}],u=[{text:"dragon_season.asc",value:0},{text:"dragon_season.desc",value:1}];const h=async()=>{console.log(e.quality,e.sort),await v()};let i=B({data:[],limit:5,alldata:[]});const o=g=>i.limit=g;F(()=>{c=c.map(n),u=u.map(n)}),T(async()=>{await v()});async function v(g=!1){U({duration:0,message:t("common.Updating_data")}),(a.data.length==0||g)&&await a.initSeason();let m=JSON.parse(JSON.stringify(a.data));i.alldata=m.sort(z("Rank")),e.quality>0?i.data=i.alldata.filter(w=>{let y=!1,p=0;for(let S=0;S<w.Player.Heroes.length;S++)w.Player.Heroes[S].grade==5&&(p=p+1);return p==e.quality&&(y=!0),e.quality==4&&p==0&&(y=!0),y}):i.data=JSON.parse(JSON.stringify(i.alldata)),e.sort==1&&(i.data=i.data.reverse()),A()}return(g,m)=>{const w=k("van-dropdown-item"),y=k("van-dropdown-menu");return x(),b(C,null,[s(y,null,{default:r(()=>[s(w,{modelValue:l(e).quality,"onUpdate:modelValue":m[0]||(m[0]=p=>l(e).quality=p),options:l(c),onChange:h,teleport:"body"},null,8,["modelValue","options"]),s(w,{modelValue:l(e).sort,"onUpdate:modelValue":m[1]||(m[1]=p=>l(e).sort=p),options:l(u),onChange:h,teleport:"body"},null,8,["modelValue","options"])]),_:1}),(x(),N(I,{isinset:!1,listLength:l(i).data.length,onChangeCount:o,key:"bad"+l(i).data.length},{default:r(()=>[(x(!0),b(C,null,P(l(i).data.slice(0,l(i).limit),(p,S)=>(x(),N(lt,{key:"player"+S,data:p},null,8,["data"]))),128))]),_:1},8,["listLength"]))],64)}}});export{mt as default};
