import{O as G,P as K,Q as H,R as T,af as k,T as P,U as Q,G as C,H as a,I as s,V as x,Z as d,L as B,M as I,X as R,a2 as N,a7 as D,Y as X,a8 as M,a9 as $,N as p,J as n,K as i,a0 as j,$ as _,a1 as F}from"./index.5bdf5f83.js";import{_ as J}from"./DataCell.vue_vue_type_script_setup_true_lang.091ecc3d.js";import{_ as O}from"./AddressLabel.vue_vue_type_style_index_0_lang.4346cc2a.js";import{u as Z}from"./hero.c8d58b89.js";const z=n("div",{style:{width:"90%"},class:"text-gray-400 text-sm text-left mt-2"},"\u5F53\u524D\u71C3\u70E7Hwt\u6570\u91CF",-1),tt={style:{width:"90%"},class:"mt-2"},et={class:"text-orange-400 text-3xl"},st={style:{width:"90%"},class:"text-left mt-1"},at=n("span",{class:"text-gray-400 text-sm"},"\u958B\u59CB:",-1),lt={key:0,class:"text-black-500 text-sm ml-1"},nt={style:{width:"90%"},class:"text-left mt-1"},ot=n("span",{class:"text-gray-400 text-sm"},"\u7576\u524D:",-1),rt={key:0,class:"text-black-500 text-sm ml-1"},ct={class:"text-left mt-2"},ut=n("span",{class:"text-gray-400 text-sm"},"\u8CEC\u865F\u6578:",-1),it={class:"text-black-500 text-sm ml-1"},dt={class:"text-left mt-2"},mt=n("span",{class:"text-gray-400 text-sm"},"\u6B21\u6578:",-1),_t={class:"text-black-500 text-sm ml-1"},ft={class:"text-left mt-2"},pt=n("span",{class:"text-gray-400 text-sm"},"$DC:",-1),ht={class:"text-black-500 text-sm ml-1"},bt={class:"text-left mt-2"},xt=n("span",{class:"text-gray-400 text-sm"},"\u622A\u6B62:",-1),yt={class:"text-black-500 text-sm ml-1"},gt=_("HWT\u71C3\u71D2"),kt=_("\u5408\u8A08\u71C3\u71D2"),Ct=_("\u6392\u540D"),vt=_("\u5408\u8A08\u71C3\u71D2"),Bt=G({__name:"index",setup(Nt){const{t:V}=K(),A=Z(),S=H(""),L=H("");let y=null,m=T({last:[],boss:[]}),v=T({last:5,boss:5});const W=o=>v.last=o,Y=o=>v.boss=o,h=T({totalDCAmount_:0,maxDC_:0,totalHWT_:0,endtime:""});let U=k.filters.Subscribed();H(!1),P(async()=>{await q()}),Q(async()=>{k.removeAllListeners(),y&&clearInterval(y)});const q=async()=>{R({duration:0,message:V("common.Updating_data")}),y&&clearInterval(y),y=setInterval(()=>{S.value=N().format("MM-DDTHH:mm:ss")});let o=await k.getInfo();console.log(o),h.totalDCAmount_=parseInt(D(o.totalDCAmount_,"ether")),h.totalHWT_=parseInt(D(o.totalHWT_,"ether")),h.endtime=N.unix(parseInt(o.endtime_)).format("YYYY-MM-DDTHH:mm");let r=[];await A.initBurnhwt();let t=A.burnhwt;t.data.length>0&&(console.log(t.data),r.push(...t.data),L.value=N.unix(t.starttimestamp).format("MM-DDTHH:mm")),w(r),X();let l=parseInt(t.endblock)+1,f=await k.queryFilter(U,l,"latest");if(f.length>0){let e=await E(f);r.push(...e),w(r)}k.on("Subscribed",async e=>{let c=await E([e]);for(let b=0;b<r.length;b++)c=c.filter(u=>u.transactionHash!=r[b].transactionHash);console.log("new Subscribed ",c),r.push(...c),w(r)})},w=o=>{let r=JSON.parse(JSON.stringify(o));r=r.sort(M("blockNumber")),m.last=r.reverse();let t=JSON.parse(JSON.stringify(o));t=t.sort(M("totalAmount")).reverse();let l=[];t.forEach((f,e)=>{l.length>0&&l.findIndex(c=>c.address==f.address)==-1&&l.push(f),l.length==0&&l.push(f)}),m.boss=l};async function E(o){let r=[],t=[];o.forEach(function(u){t.findIndex(g=>g.blockNumber==u.blockNumber)==-1?t.push({blockNumber:u.blockNumber,blockTotal:1}):t.find(g=>g.blockNumber==u.blockNumber).blockTotal+=1});let l=t[0].blockNumber,f=(await $.getBlock(l)).timestamp,e=t[t.length-1].blockNumber,c=(await $.getBlock(e)).timestamp,b=0;return e>l&&(b=(c-f)/(e-l)),t.forEach(function(u){u.timestamp=f+(u.blockNumber-l)*b}),o.forEach(function(u){r.push({address:u.args.user,timestamp:t.find(g=>g.blockNumber==u.blockNumber).timestamp,blockNumber:u.blockNumber,transactionHash:u.transactionHash,amount:parseInt(D(u.args.amount,"ether")),totalAmount:parseInt(D(u.args.totalAmount,"ether"))})}),r}return(o,r)=>{const t=I("van-col"),l=I("van-row"),f=I("van-cell-group");return p(),C(B,null,[a(f,{inset:"",class:"mt-2"},{default:s(()=>[a(l,{class:"py-2 ml-2"},{default:s(()=>[a(t,{span:"12"},{default:s(()=>[z,n("div",tt,[n("span",et,i(h.totalHWT_),1)]),n("div",st,[at,d(m).last.length?(p(),C("span",lt,i(L.value),1)):j("",!0)]),n("div",nt,[ot,d(m).last.length?(p(),C("span",rt,i(S.value),1)):j("",!0)])]),_:1}),a(t,{span:"12"},{default:s(()=>[n("div",ct,[ut,n("span",it,i(d(m).boss.length),1)]),n("div",dt,[mt,n("span",_t,i(d(m).last.length),1)]),n("div",ft,[pt,n("span",ht,i(h.totalDCAmount_),1)]),n("div",bt,[xt,n("span",yt,i(h.endtime),1)])]),_:1})]),_:1})]),_:1}),(p(),x(J,{title:"\u6700\u65B0\u71C3\u71D2",listLength:d(m).last.length,onChangeCount:W,key:"last"+d(m).last.length},{default:s(()=>[a(l,{justify:"center",class:"my-2 text-center"},{default:s(()=>[a(t,{span:"4",class:"text-base text-gray-500"},{default:s(()=>[_(i(o.$t("callhero.list_time")),1)]),_:1}),a(t,{span:"6",class:"text-base text-gray-500"},{default:s(()=>[_(i(o.$t("callhero.list_address")),1)]),_:1}),a(t,{span:"6",class:"text-base text-gray-500"},{default:s(()=>[gt]),_:1}),a(t,{span:"8",class:"text-base text-gray-500"},{default:s(()=>[kt]),_:1})]),_:1}),(p(!0),C(B,null,F(d(m).last.slice(0,d(v).last),(e,c)=>(p(),x(l,{justify:"center",class:"text-center",style:{"border-top":"thin solid #e5e7eb"},key:"last"+e.blockNumber+e.address+c*1e3},{default:s(()=>[a(t,{span:"4",class:"py-2 text-sm"},{default:s(()=>[_(i(d(N).unix(e.timestamp).format("HH:mm")),1)]),_:2},1024),a(t,{span:"6",class:"py-2"},{default:s(()=>[(p(),x(O,{address:e.address,key:"last"+e.blockNumber+e.address+c*1e3},null,8,["address"]))]),_:2},1024),a(t,{span:"6",class:"py-2"},{default:s(()=>[_(i(e.amount),1)]),_:2},1024),a(t,{span:"8",class:"py-2"},{default:s(()=>[_(i(e.totalAmount),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["listLength"])),(p(),x(J,{title:"\u71C3\u71D2\u6392\u884C\u699C",listLength:d(m).boss.length,onChangeCount:Y,key:"boss"+d(m).boss.length},{default:s(()=>[a(l,{justify:"center",class:"my-2 text-center"},{default:s(()=>[a(t,{span:"4",class:"text-base text-gray-500"},{default:s(()=>[Ct]),_:1}),a(t,{span:"8",class:"text-base text-gray-500"},{default:s(()=>[_(i(o.$t("callhero.list_address")),1)]),_:1}),a(t,{span:"12",class:"text-base text-gray-500"},{default:s(()=>[vt]),_:1})]),_:1}),(p(!0),C(B,null,F(d(m).boss.slice(0,d(v).boss),(e,c)=>(p(),x(l,{justify:"center",class:"text-center",style:{"border-top":"thin solid #e5e7eb"},key:"boss"+e.blockNumber+e.address+c*1e3},{default:s(()=>[a(t,{span:"4",class:"py-2 text-sm"},{default:s(()=>[_(i(c+1),1)]),_:2},1024),a(t,{span:"8",class:"py-2"},{default:s(()=>[(p(),x(O,{address:e.address,key:"boss"+e.blockNumber+e.address+c*1e3},null,8,["address"]))]),_:2},1024),a(t,{span:"12",class:"py-2"},{default:s(()=>[_(i(e.totalAmount),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["listLength"]))],64)}}});export{Bt as default};
