import{O as R,M as k,N as x,G as b,H as n,I as r,J as m,af as M,K as i,$ as H,Z as l,ar as $,as as N,L as C,a1 as P,V,a5 as j,a2 as O,a7 as Y,P as F,R as B,at as J,ac as T,X as U,a9 as z,Y as A}from"./index.eca9a6c2.js";import{_ as I}from"./DataCell.vue_vue_type_script_setup_true_lang.a5ea22b4.js";import{q as L}from"./hero.d6daa2c6.js";function D(_,t){return Math.floor(_*t/60/200)}function K(_,t){let a=25,e=Number(_);return a-=25*e/(e+1e3),Math.floor(60*t/a)}function q(_,t=-1){if(t==0)return[{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0},{max_sec:0,max_floor:0,kill_count:0}];let a=[0,0,0],e=[0,0,0],s=[0,0,0],c=0,u=0;for(let o=0;o<_.length;o++){let h=K(_[o].defense,_[o].hp);a[o]=h,t>0&&t<h&&(a[o]=t),e[o]=D(_[o].attack,a[o]),s[o]=Math.floor(e[o]/10+1),u+=e[o],a[o]>c&&(c=a[o])}let v=Math.floor(u/10);return[{max_sec:c,max_floor:v,kill_count:u},{max_sec:a[0],max_floor:s[0],kill_count:e[0]},{max_sec:a[1],max_floor:s[1],kill_count:e[1]},{max_sec:a[2],max_floor:s[2],kill_count:e[2]}]}function Z(_,t=1e3){let a=q(_);if(t>a[0].max_floor||t<=0)return-1;let e=1,s=a[0].max_sec;for(;e<=s;){let c=Math.floor((e+s)/2),u=q(_,c);if(t==u[0].max_floor)return c;t>u[0].max_floor?e=c+1:s=c-1}return-1}const E={class:"rounded-lg shadow-lg max-w-sm m-3 border-2"},G={class:"pt-6 pl-2"},X={class:"text-gray-500 text-sm pt-2"},Q={class:"text-gray-500 text-sm pt-1"},W={class:"text-gray-500 text-sm pt-1"},tt={class:"text-gray-500 text-sm pt-1"},at={class:"text-gray-500 text-sm pt-1"},et={class:"absolute -top-4 -left-8"},ot={class:"-mt-2 text-gray-500 text-center text-sm"},st={class:"text-gray-500 text-center text-sm"},nt={class:"text-gray-500 text-center text-sm"},lt=R({__name:"PlayerCard",props:{data:null},setup(_){const t=_;return(a,e)=>{const s=k("van-col"),c=k("van-tag"),u=k("van-row"),v=k("van-image"),d=k("van-badge");return x(),b("div",E,[n(u,{justify:"space-around"},{default:r(()=>[n(s,{span:"4"},{default:r(()=>[m("div",G,[m("span",{class:M(["rounded-lg bg-blue-500 p-2 text-white",t.data.Rank<10?"text-3xl":"text-xl"])},i(t.data.Rank),3)])]),_:1}),n(s,{span:"20"},{default:r(()=>[m("div",X,i(t.data.Name),1),n(u,{justify:"space-around"},{default:r(()=>[n(s,{span:"6"},{default:r(()=>[m("div",null,[n(c,{plain:"",type:"primary",class:"mr-2"},{default:r(()=>[H(i(t.data.Player.Level)+i(a.$t("dragon_season.level")),1)]),_:1})]),m("div",null,[n(c,{type:"primary"},{default:r(()=>[H(i(a.$t("dragon_stage."+t.data.Player.Stage)),1)]),_:1})])]),_:1}),n(s,{span:"10"},{default:r(()=>[m("div",Q,i(t.data.Player.FightPower)+i(a.$t("dragon_season.floor"))+"/"+i(l($)(l(q)(t.data.Player.Heroes)[0].max_sec)),1),m("div",W,"1000"+i(a.$t("dragon_season.floor"))+"/"+i(l($)(l(Z)(t.data.Player.Heroes))),1)]),_:1}),n(s,{span:"8"},{default:r(()=>[m("div",tt,i(a.$t("dragon_season.hwt"))+":"+i(l(N)(t.data.HwtReward,".")),1),m("div",at,i(a.$t("dragon_season.crystal"))+":"+i(l(N)(t.data.UsdReward,".")),1)]),_:1})]),_:1})]),_:1})]),_:1}),n(u,{class:"m-2",justify:"space-around"},{default:r(()=>[(x(!0),b(C,null,P(t.data.Player.Heroes,(o,h)=>(x(),V(s,{span:"8",key:"hero"+h},{default:r(()=>{var g;return[m("div",{class:M(["border-solid border-1 rounded m-1 p-1","border-"+((g=l(L).find(f=>f.quality==o.grade))==null?void 0:g.color)+"-500"])},[n(d,{content:o.level,position:"top-left",color:"#1989fa"},{default:r(()=>[n(u,null,{default:r(()=>[n(s,{span:"16",class:"relative"},{default:r(()=>[m("div",et,[n(v,{width:"8rem",height:"6rem",fit:"cover",position:"left",src:"/static/images/dragon/hero/"+o.code+".png"},null,8,["src"]),m("div",ot,i(a.$t("dragon_hero."+o.code)),1),m("div",st,i(l(q)([o])[0].max_floor)+i(a.$t("dragon_season.floor")),1),m("div",nt,i(l($)(l(q)([o])[0].max_sec)),1)])]),_:2},1024),n(s,{span:"8"},{default:r(()=>[(x(!0),b(C,null,P(o.items,(f,w)=>{var y;return x(),b("div",{key:"item"+w,class:M(["m-1 mt-3","bg-"+((y=l(L).find(p=>p.quality==f.grade))==null?void 0:y.color)+"-400"])},[n(d,{content:f.level,position:"top-left",color:"#1989fa"},{default:r(()=>[n(d,{content:f.score,position:"bottom-right",color:"#6B7280"},{default:r(()=>[m("div",{class:M(f.soulbound?"border-dotted border-2 border-gray-500":"")},[n(v,{width:"100%",height:"100%",fit:"cover",src:"/static/images/dragon/item/"+f.code+".png"},null,8,["src"])],2)]),_:2},1032,["content"])]),_:2},1032,["content"])],2)}),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])],2)]}),_:2},1024))),128))]),_:1})])}}}),rt="https://tools-1258577806.cos.ap-hongkong.myqcloud.com/honorworld/dragon/season/last.zip.json",it=j("season",{state:()=>({data:[],info:{}}),actions:{async initSeason(){let _=rt+"?="+O().format("YYYYMMDDHHMM"),t=await Y(_);return this.data=t.data,this.info=t.info,this.data}}}),dt=it,mt=R({__name:"index",setup(_){const{t}=F(),a=dt();let e=B({quality:0,sort:0});const s=function(g){return g.text=t(g.text),g};let c=[{text:"dragon_season.all_quality",value:0},{text:"dragon_season.one_5",value:1},{text:"dragon_season.two_5",value:2},{text:"dragon_season.all_5",value:3},{text:"dragon_season.zero_5",value:4}],u=[{text:"dragon_season.asc",value:0},{text:"dragon_season.desc",value:1}];const v=async()=>{console.log(e.quality,e.sort),await h()};let d=B({data:[],limit:5,alldata:[]});const o=g=>d.limit=g;J(()=>{c=c.map(s),u=u.map(s)}),T(async()=>{await h()});async function h(g=!1){U({duration:0,message:t("common.Updating_data")}),(a.data.length==0||g)&&await a.initSeason();let f=JSON.parse(JSON.stringify(a.data));d.alldata=f.sort(z("Rank")),e.quality>0?d.data=d.alldata.filter(w=>{let y=!1,p=0;for(let S=0;S<w.Player.Heroes.length;S++)w.Player.Heroes[S].grade==5&&(p=p+1);return p==e.quality&&(y=!0),e.quality==4&&p==0&&(y=!0),y}):d.data=d.alldata,e.sort==1&&(d.data=d.data.reverse()),A()}return(g,f)=>{const w=k("van-dropdown-item"),y=k("van-dropdown-menu");return x(),b(C,null,[n(y,null,{default:r(()=>[n(w,{modelValue:l(e).quality,"onUpdate:modelValue":f[0]||(f[0]=p=>l(e).quality=p),options:l(c),onChange:v,teleport:"body"},null,8,["modelValue","options"]),n(w,{modelValue:l(e).sort,"onUpdate:modelValue":f[1]||(f[1]=p=>l(e).sort=p),options:l(u),onChange:v,teleport:"body"},null,8,["modelValue","options"])]),_:1}),(x(),V(I,{isinset:!1,listLength:l(d).data.length,onChangeCount:o,key:"bad"+l(d).data.length},{default:r(()=>[(x(!0),b(C,null,P(l(d).data.slice(0,l(d).limit),(p,S)=>(x(),V(lt,{key:"player"+S,data:p},null,8,["data"]))),128))]),_:1},8,["listLength"]))],64)}}});export{mt as default};
