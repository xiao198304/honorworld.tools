import{J as G,$ as K,ah as M,K as j,H as c,I as f,P as I,Y as i,ai as W,T as u,U as l,V as h,G as F,N as v,W as P,Z as Y,X as s,aj as Z,R as H,a8 as z,a1 as D,ak as tt,al as et,a2 as at,am as ot,Q as nt}from"./index.112592e8.js";import{t as x,s as st,b as lt,r as rt,A as it}from"./hero.45b83604.js";import{a as B,c as A,s as E}from"./function-call.54a639f4.js";const ut={class:"flex justify-between"},ct={class:"text-base ml-1 inline-block align-top"},mt={key:0,class:"text-sm text-gray-500"},dt={key:1,class:"text-sm text-red-500"},pt={class:"text-base ml-1"},ft=i("div",{class:"h-40"},null,-1),gt={class:"py-3"},vt={class:"mb-2 text-center"},yt={class:"inline-block align-top ml-1 text-gray-900 text-lg font-medium"},_t={class:"mx-auto text-center"},wt=G({__name:"NftCard",props:{title:String,thumb:String,amount:{type:Number,default:1},quality:{type:Number,default:1},race:{type:Number,default:1},level:{type:Number,default:1},lvPower:{type:Number,default:1},className:{type:Number,default:1},source:{type:Number,default:1},code:{type:Number,default:1001},tokenId:{type:Number,default:0}},emits:["onRefresh"],setup(R,{emit:N}){const t=R,{t:C}=K(),{address:_,signer:w}=M(),b=["border-gray-500","border-gray-500","border-green-500","border-blue-500","border-purple-500","border-yellow-500"],S=j(!1),a=j(""),U=j(1),m=()=>{U.value=t.amount,S.value=!0},O=async()=>{B({duration:0,message:C("common.Operation_progress")});try{t.tokenId==0?await(await new z(x.HeroNFT1155.address,x.HeroNFT1155.abi,w.value).safeTransferFrom(_.value,a.value,t.code,U.value,"0x00")).wait():await(await new z(x.HeroNFT.address,x.HeroNFT.abi,w.value).transferFrom(_.value,a.value,t.tokenId)).wait()}catch{A(),E("Error!")}A(),N("onRefresh")},J=async()=>{B({duration:0,forbidClick:!0,message:C("common.Operation_progress")});const r=x.NFTStaking.address,d=x.NFTStaking.abi;let p=new z(r,d,w.value);try{t.tokenId==0?await(await p.unstake([t.code],[t.amount],[])).wait():await(await p.unstake([],[],[t.tokenId])).wait()}catch{A(),E("Error!")}A(),N("onRefresh")};return(r,d)=>{const p=c("van-icon"),V=c("van-tag"),e=c("van-button"),n=c("van-cell"),y=c("van-field"),k=c("van-cell-group"),$=c("van-dialog");return f(),I(H,null,[i("div",{class:Y(["rounded-lg shadow-lg max-w-sm m-3 border-2",b[t.quality]])},[i("div",{class:"m-2 bg-no-repeat bg-cover bg-top",style:W("background-image: url("+t.thumb+"); background-position-y: -80px")},[i("div",ut,[i("div",null,[u(p,{name:"/static/images/race/"+t.race+".png"},null,8,["name"]),i("span",ct,"Lv."+l(t.level),1)]),t.source==1?(f(),I("div",mt,l(r.$t("mynft.mine_pool")),1)):h("",!0),t.source==2?(f(),I("div",dt,l(r.$t("mynft.free")),1)):h("",!0),i("div",null,[u(p,{name:"/static/images/item/top_icon2.png"}),i("span",pt,l(t.lvPower),1)])]),ft,i("div",gt,[i("div",vt,[u(p,{name:"/static/images/class/"+t.className+".png",size:"1.3rem"},null,8,["name"]),i("span",yt,l(t.title),1),t.amount>1?(f(),F(V,{key:0,class:"ml-1",color:"#111827",plain:""},{default:v(()=>[P("X"+l(t.amount),1)]),_:1})):h("",!0)]),i("div",_t,[t.source==1?(f(),F(e,{key:0,plain:"",type:"default",size:"small",icon:"paid-o",class:"mr-2",onClick:J},{default:v(()=>[P(l(r.$t("mynft.unstake")),1)]),_:1})):h("",!0),t.source==2?(f(),F(e,{key:1,type:"default",size:"small",icon:"share-o",onClick:m},{default:v(()=>[P(l(r.$t("mynft.transfer")),1)]),_:1})):h("",!0)])])],4)],2),u($,{show:S.value,"onUpdate:show":d[2]||(d[2]=g=>S.value=g),title:r.$t("mynft.transfer"),"show-cancel-button":"",onConfirm:O},{default:v(()=>[u(k,{inset:""},{default:v(()=>[u(n,{title:r.$t("mynft.from_address"),value:s(_)},null,8,["title","value"]),u(n,{title:"NFT",value:t.title},null,8,["value"]),u(y,{modelValue:R.amount,"onUpdate:modelValue":d[0]||(d[0]=g=>Z(amount)?amount.value=g:null),type:"digit",label:r.$t("mynft.amount_transfer")},null,8,["modelValue","label"]),u(y,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=g=>a.value=g),label:r.$t("mynft.to_address")},null,8,["modelValue","label"])]),_:1})]),_:1},8,["show","title"])],64)}}}),bt={class:"flex justify-between mx-4 my-2"},kt={class:"text-sm text-gray-500"},ht={class:"text-gray-900"},Nt={class:"text-sm text-gray-500"},Ct={class:"grid grid-cols-2 md:lg:xl:grid-cols-5 group bg-white shadow-xl shadow-neutral-100 border"},xt=G({__name:"index",setup(R){const{t:N}=K(),t=function(e){return e.text=N(e.text),e};let C=JSON.parse(JSON.stringify(st)),_=JSON.parse(JSON.stringify(lt)),w=JSON.parse(JSON.stringify(rt));const{address:b,isActivated:S}=M();let a=D({nfts:[],limit:10,page:1,total:0,totalnft:0});const{onActivated:U}=tt();let m=D({source:0,quality:0,race:0});const O=j(!1),J=async()=>{await p(b.value),E(N("common.Refresh_succeeded")),O.value=!1},r=async(e=0)=>{console.log(m.source),await p(b.value)},d=async()=>{console.log(a.page),await p(b.value)};U(async({address:e})=>{console.log("activate: ",e),await p(e)}),et(()=>{C=C.map(t),_=_.map(t),w=w.map(t)}),at(async()=>{console.log("activate: ",b.value),await p(b.value)});async function p(e=""){B({duration:0,forbidClick:!0,message:N("common.Updating_data")});const n=await V(e,m.quality,m.race,m.source,a.page,a.limit);a.nfts=n.nfts,a.limit=n.limit,a.page=n.page,a.total=n.total,a.totalnft=n.totalnft,A()}async function V(e="",n=0,y=0,k=0,$=1,g=20){if(e=="")return{nfts:[],limit:g,page:$,total:0,totalnft:0};let q=!0;k==3&&(q=!1,k=0);const T=await ot("https://service-q42yv3pc-1258577806.hk.apigw.tencentcs.com/release/",{url:"nft/inventory/list",pjson:{address:e,merge:q,page:{number:$,size:g},filter:{quality:n,race:y,source:k}}}),Q=it(T.list);return console.log("res: ",T),{nfts:Q,limit:T.limit,page:T.page,total:T.total,totalnft:T.totalnft}}return(e,n)=>{const y=c("van-dropdown-item"),k=c("van-dropdown-menu"),$=c("van-sticky"),g=c("van-pull-refresh"),q=c("van-icon"),L=c("van-pagination");return f(),I(H,null,[u($,{"offset-top":40},{default:v(()=>[s(S)?(f(),F(k,{key:0},{default:v(()=>[u(y,{modelValue:s(m).source,"onUpdate:modelValue":n[0]||(n[0]=o=>s(m).source=o),options:s(C),onChange:r},null,8,["modelValue","options"]),u(y,{modelValue:s(m).quality,"onUpdate:modelValue":n[1]||(n[1]=o=>s(m).quality=o),options:s(_),onChange:r},null,8,["modelValue","options"]),u(y,{modelValue:s(m).race,"onUpdate:modelValue":n[2]||(n[2]=o=>s(m).race=o),options:s(w),onChange:r},null,8,["modelValue","options"])]),_:1})):h("",!0)]),_:1}),i("div",bt,[i("div",kt,[P(l(e.$t("mynft.total_NFT"))+"\uFF1A",1),i("span",ht,l(s(a).totalnft),1)]),i("div",Nt,l(e.$t("mynft.total_of"))+l(s(a).total)+l(e.$t("mynft.items"))+"\uFF0C"+l(e.$t("mynft.per_page"))+l(s(a).limit)+l(e.$t("mynft.items"))+"\uFF0C"+l(e.$t("mynft.current"))+l(s(a).page)+l(e.$t("mynft.page")),1)]),u(g,{modelValue:O.value,"onUpdate:modelValue":n[3]||(n[3]=o=>O.value=o),onRefresh:J},{default:v(()=>[i("div",Ct,[(f(!0),I(H,null,nt(s(a).nfts,(o,X)=>(f(),F(wt,{key:"nft"+X,title:e.$t(o.name),thumb:"/static/images/"+o.code+".png",amount:o.amount,quality:o.quality,level:o.level,race:o.race,lvPower:o.lvPower,className:o.class,source:o.source,code:o.code,tokenId:o.tokenId,onOnRefresh:J},null,8,["title","thumb","amount","quality","level","race","lvPower","className","source","code","tokenId"]))),128))])]),_:1},8,["modelValue"]),s(a).total>0?(f(),F(L,{key:0,modelValue:s(a).page,"onUpdate:modelValue":n[4]||(n[4]=o=>s(a).page=o),"total-items":s(a).total,"items-per-page":s(a).limit,"show-page-size":3,"force-ellipses":"",onChange:d},{"prev-text":v(()=>[u(q,{name:"arrow-left"})]),"next-text":v(()=>[u(q,{name:"arrow"})]),_:1},8,["modelValue","total-items","items-per-page"])):h("",!0)],64)}}});export{xt as default};
